language: rust

matrix:
  include:
    - os: windows
      rust: nightly-x86_64-pc-windows-gnu
      before_install:
        - choco install buck
      before_script:
        - rm cmd/src/gen cmd/src/syntax gen/include macro/src/syntax src/gen src/syntax
        - cp -r include gen; cp -r gen cmd/src; cp -r syntax cmd/src; cp -r syntax macro/src; cp -r gen src; cp -r syntax src
        - cp third-party/Cargo.lock .
        - cargo vendor --versioned-dirs --locked third-party/vendor
      script:
        - buck build :cxx#check --verbose=0
        - buck run demo-rs --verbose=0
        - buck test ... --verbose=0
